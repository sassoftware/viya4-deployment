---
apiVersion: builtin
kind: PatchTransformer
metadata: 
  name: compute-podtemplate-affinity-0
patch: |-
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: compute-podtemplate-affinity
  template:
    metadata:
      labels:
        workload.sas.com/class: compute
    spec:
      tolerations:
        - key: workload.sas.com/class
          operator: Equal
          value: compute
          effect: NoSchedule
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - compute
          - weight: 50
            preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - cas
                - stateless
                - stateful
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
target:
    kind: PodTemplate
    name: .*