---
- name: Add csi drivers
  command: kubectl apply --kubeconfig {{ kubeconfig }} -k "github.com/kubernetes-sigs/aws-{{ item }}-csi-driver/deploy/kubernetes/overlays/stable/?ref=master"
  when:
    - V4_CFG_MANAGE_STORAGECLASS
  with_items:
    - ebs
    - efs
  tags:
    - install
    - uninstall
    - upgrade

- name: Add storage classes
  include_tasks: vdm_loader.yaml
  vars:
    resources:
      - "{{ VDM_RESOURCES_PATH }}/ebs-sc.yaml"
    transformers: 
      - "{{ VDM_TRANSFORMERS_PATH }}/sas-rwo-sc.yaml"
      - "{{ VDM_TRANSFORMERS_PATH }}/sas-rwx-sc.yaml"
  when:
    - V4_CFG_MANAGE_STORAGECLASS
  tags:
    - install
    - uninstall
    - upgrade