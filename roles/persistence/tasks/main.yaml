- name: Create persistence folder
  file:
    state: directory
    path: "{{DEPLOY_DIR}}/site-config"
  tags:
    - vdm

- name: Create sssd directory
  file:
    state: directory
    path:  "{{DEPLOY_DIR}}/site-config/sssd"
  when:
    - SSSD is defined
    - SSSD is not none
  tags:
    - vdm

- include_tasks: copy.yaml
  vars:
    src: "{{ item.src }}"
    dest: "{{ DEPLOY_DIR }}/site-config/{{ item.dest }}"
  with_items:
    - { src: "{{ KUBE |default('', true) }}", dest: ".kube" }
    - { src: "{{ CONFIG |default('', true) }}", dest: "defaults.yaml" }
    - { src: "{{ SSSD |default('', true) }}", dest: "sssd/configmap.yaml" }
    - { src: "{{ SITEDEFAULT |default('', true) }}", dest: "sitedefault.yaml" }
    - { src: "{{ JUMP_SVR_PRIVATE_KEY |default('', true) }}", dest: ".ssh" }
  when:
    - item.src is defined
    - item.src != ''
    - item.src != DEPLOY_DIR + '/site-config/' + item.dest
  tags:
    - vdm
    
- include_vars:
    file: "{{DEPLOY_DIR}}/site-config/defaults.yaml"
  when: CONFIG is not defined
  tags:
    - vdm
