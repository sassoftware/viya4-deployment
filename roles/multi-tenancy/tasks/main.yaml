# Copyright Â© 2020-2024, SAS Institute Inc., Cary, NC, USA. All Rights Reserved.
# SPDX-License-Identifier: Apache-2.0

---
# This file contains the main tasks for the multi-tenancy role, handling onboarding, offboarding, and setup for tenants.
# Each block is conditionally included based on configuration variables and tags.

# Include multi-tenant setup tasks
- name: Multi-tenant setup
  include_tasks:
    file: multi-tenant-setup.yaml
  when:
    - V4MT_ENABLE is defined
    - V4MT_ENABLE
  tags:
    - multi-tenancy

# Include onboarding/offboarding tasks for tenants
- name: Multi-tenant onboard/offboard
  include_tasks:
    file: multi-tenant-onboard-offboard.yaml
  when:
    - V4MT_ENABLE is defined
    - V4MT_ENABLE
    - ("onboard" in ansible_run_tags or "offboard" in ansible_run_tags)
  tags:
    - multi-tenancy

# Include CAS server onboarding/offboarding tasks for tenants
- name: Onboard/offboard CAS servers for tenants
  include_tasks:
    file: onboard-offboard-cas-servers.yaml
  when:
    - V4MT_ENABLE is defined
    - V4MT_ENABLE
    - ("cas-onboard" in ansible_run_tags)
  tags:
    - multi-tenancy

# Include tenant pod template customizations
- name: Tenant pod templates
  include_tasks:
    file: tenant-pod-templates.yaml
  when:
    - V4MT_ENABLE is defined
    - V4MT_ENABLE
  tags:
    - multi-tenancy

# Include tenant CAS customizations
- name: Tenant CAS customizations
  include_tasks:
    file: tenant-cas-customizations.yaml
  when:
    - V4MT_ENABLE is defined
    - V4MT_ENABLE
  tags:
    - multi-tenancy
